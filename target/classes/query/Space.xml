<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.space.space.dao.SpaceDAO">


	<!-- 게시물 전체 조회 -->
	<select id="spaceList" parameterType="space" resultType="space">
		/* Space - spaceList */
		select sp_num, sp_name, sp_address, sp_type,
		sp_stock, sp_rest
		from
		( select list.*, rownum as rnum
		from (
		select sp_num, sp_name, sp_address, sp_type, sp_stock, sp_rest
		from tb_space where cp_num = #{cp_Num}
		<where>
			<if test="keyword != null and keyword != ''">
				sp_name like '%' || #{keyword} || '%'
			</if>
		</where>
		order by sp_num desc
		) list
		)
		<where>
			<if test="start_row != null and start_row != ''">
				<if test="end_row != null and end_row != ''">
					rnum between #{start_row} and #{end_row}
				</if>
			</if>
		</where>
	</select>

	<!-- 게시물 총 개수 -->
	<select id="spaceListCnt" parameterType="space" resultType="int">
		<!-- Space - SpaceListCnt -->
		select nvl(count(1), 0) from
		( select list.*, rownum as rnum
		from(
		select * from tb_space
		<where>
			<if test="keyword != null and keyword != ''">
				sp_name like '%' || #{keyword} || '%'
			</if>
		</where>
		) list
		)
	</select>


	<!-- 공간 등록 -->
	<insert id="spaceInsert" parameterType="space">
		<selectKey keyProperty="sp_Num" resultType="int"
			order="BEFORE">
			select tb_space_seq.nextval from dual
		</selectKey>
		insert into tb_space(
		sp_Num,
		sp_Type,
		sp_Stock,
		sp_Name,
		sp_Price,
		sp_Address,
		sp_Contract1,
		sp_Contract2,
		sp_Opendate,
		sp_Exposition,
		sp_File,
		sp_Service,
		sp_Traffic,
		sp_Rest,
		cp_Num
		)
		VALUES(
		#{sp_Num},
		#{sp_Type,
		jdbcType=VARCHAR},
		#{sp_Stock, jdbcType=VARCHAR},
		#{sp_Name,
		jdbcType=VARCHAR},
		#{sp_Price},
		#{sp_Address, jdbcType=VARCHAR},
		#{sp_Contract1, jdbcType=VARCHAR},
		#{sp_Contract2, jdbcType=VARCHAR},
		#{sp_Opendate, jdbcType=VARCHAR},
		#{sp_Exposition, jdbcType=VARCHAR},
		#{sp_File, jdbcType=VARCHAR},
		#{sp_Service, jdbcType=VARCHAR},
		#{sp_Traffic, jdbcType=VARCHAR},
		#{sp_Stock, jdbcType=VARCHAR},
		(select cp_num from tb_company where cp_id=#{cp_Id})
		)
	</insert>


</mapper>
